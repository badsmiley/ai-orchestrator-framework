# Session Spawn Runbook

Как запустить и управлять субагентами (департаментами) через ClawdBot.

## Создание департамента

### Шаг 1: Определи параметры

| Параметр | Описание | Пример |
|----------|----------|--------|
| `agentId` | Тип агента | `default`, `coding-agent` |
| `label` | Имя департамента | `LCH Dev`, `HELIX Web` |
| `task` | Что делать | "Настроить Stripe интеграцию" |
| `model` | Модель (опционально) | `minimax/MiniMax-M2.1` |

### Шаг 2: Спавни агента

```bash
/sessions_spawn agentId=default label="LCH Dev" task="Настроить Stripe Pro monthly для LCH. Нужно: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, NEXT_PUBLIC_APP_URL"
```

### Шаг 3: Получи результат

Агент работает в своей сессии. Когда закончит — результат приходит в main chat.

---

## Управление сессиями

### Посмотреть активные сессии

```bash
/sessions_list
```

### Отправить сообщение в сессию

```bash
/sessions_send sessionKey={key} message="Добавь логирование"
```

### Посмотреть историю сессии

```bash
/sessions_history sessionKey={key}
```

### Убить сессию

```bash
# Через process tool, если нужно
```

---

## Micro-report паттерн

Когда департамент (L1) работает, он должен отправлять Оркестратору (L0) краткие отчёты:

```markdown
**LCH Dev — В процессе**

✓ Stripe интеграция: env vars добавлены
→ Следующий шаг: настроить webhook handler
⚠ Жду от человека: STRIPE_WEBHOOK_SECRET
```

---

## Best Practices

1. **Одна задача — один агент** Не пихай всё в одну сессию.
2. **Micro-reports** Лучше 10 коротких отчётов, чем один огромный в конце.
3. **Контекст** Агент помнит только свою сессию. Важное — пиши в файлы.
4. **Не блокируй** Если ждёшь что-то от человека — сообщи и дай знать когда продолжить.
5. **Чистый выход** Когда.done — завершай сессию (`cleanup=delete`).

---

## Пример полного цикла

```markdown
[Человек] → "Настрой Stripe для LCH"

[L0 Orchestrator]
→ Декомпозирует на 3 подзадачи
→ Спавнит LCH Dev

[L1 LCH Dev]
→ Работает над задачей
→ Micro-report 1: "✓ env vars добавлены"
→ Micro-report 2: "✓ webhook создан, жду secret"
→ Micro-report 3: "✓ всё готово, тестируем"

[L0 Orchestrator]
→ Получает финальный отчёт
→ Сообщает человеку: "Готово!"
→ (Опционально) Завершает сессию
```

---

## Troubleshooting

| Проблема | Решение |
|----------|---------|
| Агент не отвечает | Проверь `/sessions_list`, возможно завис |
| Потерялся контекст | Агент помнит только свою сессию. Важное — в файлы. |
| Слишком много данных | Уменьши задачу, разбей на части |
| Нужна внешняя информация | Запроси у человека, не гадай |
